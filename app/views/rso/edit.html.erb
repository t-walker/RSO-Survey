<div class="row">
  <div class="col-md-12">
    <% if flash[:success] %>
        <div class="alert alert-success"><%= flash[:success] %></div>
    <% end %>
    <% if flash[:error] %>
        <div class="alert alert-danger"><%= flash[:error] %></div>
    <% end %>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <%= form_tag({controller: "rso", action: "modify_rso"}, method: "post", id: "modify_rso") do %>
      <%= hidden_field_tag(:rso_id, @rso.id) %>
      <div class="form-group row">
        <%= label_tag :name, "Name: ", class: "col-2 col-form-label"%>
        <div class="col-10">
          <%= text_field_tag :name, @rso.name, class: "form-control", type: "text" %>
        </div>
      </div>
      <div class="form-group row">
        <%= label_tag :nickname, "Nickname: ", class: "col-2 col-form-label"%>
        <div class="col-10">
          <%= text_field_tag :nickname, @rso.nickname, class: "form-control", type: "text" %>
        </div>
      </div>
    <% end %>
    <%= form_tag({controller: "rso", action: "delete_rso"}, method: "post", id: "delete_rso") do %>
      <%= hidden_field_tag(:rso_id, @rso.id) %>
    <% end %>
    <div class="btn-group">
      <%= button_tag(type:"submit", class: "btn btn-success", form: "modify_rso") do %>
        <i class="fa fa-check" aria-hidden="true"></i>
        Update RSO
      <% end %>
      <%= button_tag(type: "submit", class: "btn btn-block btn-danger", form: "delete_rso") do %>
        <i class="fa fa-trash" aria-hidden="true"></i>
        Delete RSO
      <% end %>
    </div>
  </div>
  <div class="card-block">
    <div class="form-group row">
      <table class="table">
        <thead>
          <th>Keyword</th>
          <th>Weight</th>
          <th>Associated Answers</th>
          <th></th>
        </thead>
        <% @rso.keywords.each do |k| %>
          <%= form_tag({controller: "rso", action: "delete_keyword"}, method: "post") do %>
            <%= hidden_field_tag(:keyword_id, k.id) %>
            <%= hidden_field_tag(:rso_id, @rso.id) %>
            <% @keyword_count = 0 %>
            <% answers = [] %>
            <% @questions = Question.all %>
            <% @questions.each do |q| %>
              <% answers = q.answers %>
              <% answers.each do |an| %>
                <% @keyword_count += an.keywords.where(keyword: k.keyword).count %>
              <% end %>
            <% end %>
            <tr>
              <td width=30%><%= k.keyword %></td>
              <td width=30%><%= k.weight %></td>
              <% if(@keyword_count == 0) %>
                <td class="text-danger" width=30%><%= @keyword_count %></td>
              <% else %>
                <td width=30%><%= @keyword_count %></td>
              <% end %>
              <td width=10%>
                <%= button_tag(type: "submit", class: "btn btn-block btn-danger") do %>
                  <i class="fa fa-trash-o" aria-hidden="true"></i>
                <% end %>
              </td>

            </tr>
          <% end %>
        <% end %>
        <%= form_tag({controller: "rso", action: "add_keyword"}, method: "post") do %>
          <%= hidden_field_tag(:rso_id, @rso.id) %>
          <tr>
            <td width=30%><%= select_tag(:keyword, options_for_select(@keywords), class: "form-control") %></td>
            <td width=30%><%= text_field_tag :weight, "", class: "form-control", type: "text" %></td>
            <td width=30%></td>
            <td width=10%>
              <%= button_tag(type: "submit", class: "btn btn-block btn-success") do %>
                <i class="fa fa-plus" aria-hidden="true"></i>
              <% end %>
            </td>
          </tr>
        <% end %>
      </table>
    </div>
    <div class="form-group row">
      <table class="table">
        <thead>
          <th>Officer Name</th>
          <th></th>

        </thead>
        <tbody>
          <% @rso.officers.each do |o| %>
            <%= form_tag({controller: "rso", action: "delete_officer"}, method: "post") do %>
              <%= hidden_field_tag(:rso_id, @rso.id) %>
              <%= hidden_field_tag(:officer_id, o.id) %>
              <tr>
                <td width=80%><%= o.full_name %></td>
                <td width=20%>
                  <%= button_tag(type: "submit", class: "btn btn-block btn-danger") do %>
                    <i class="fa fa-trash-o" aria-hidden="true"></i>
                  <% end %>
                </td>
              </tr>
            <% end %>
          <% end %>
          <%= form_tag({controller: "rso", action: "add_officer"}, method: "post") do %>
            <%= hidden_field_tag(:rso_id, @rso.id) %>
            <tr>
              <td width=80%><%= select_tag(:officer_id, options_from_collection_for_select(@officers, :id, :full_name), class: "form-control") %></td>
              <td width=20%>
                <%= button_tag(type: "submit", class: "btn btn-block btn-success") do %>
                  <i class="fa fa-plus" aria-hidden="true"></i>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

  </div>
  <div class="card-footer">

  </div>
</div>
